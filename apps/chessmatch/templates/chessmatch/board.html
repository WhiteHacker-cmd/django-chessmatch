{%extends "base.html"%}

{%block scripts%}
{{super()}}
<script>
    window.latest_seen = '';

    window.unicodes = {
        'K': '&#9818',
        'Q': '&#9819',
        'R': '&#9820',
        'B': '&#9821',
        'N': '&#9822',
        'P': '&#9823',
    }
    window.colors = ['white','red','black','green'];

    function fetch_history() {
        $.get('{{url('chessmatch_history', slug=game.slug)}}'+latest_seen, function(data) {
            for (var i=0; i < data.length; i++) {
                move = data[i].fields
                var $square = $('#square-'+move.to_coord)

                if (move.turn == 0) { // first placement, create piece 
                    var $piece = $('<div class="piece '+window.colors[move.color]+'"/>')
                    $piece.html(window.unicodes[move.piece])
                    $square.empty()
                    $square.append($piece)
                }
            }
        })
    }

    $(function() {
        fetch_history();
    })
</script>
{%endblock%}

{%block content%}

    {{game}}

    <table class="chessboard">
    {%for rank in range(14,0,-1)%}
        <tr>
        {%for file in 'abcdefghijklmn'%}
            <td class="square 
                {%if rank % 2%} 
                    {%if file in 'acegikm'%}black{%else%}white{%endif%} 
                {%else%} 
                    {%if file in 'bdfhjln'%}black{%else%}white{%endif%} 
                {%endif%} 

                {%if (rank < 4 and file in 'abclmn') or (rank > 11 and file in 'abclmn') %}
                    unusable
                {%endif%}
                " 
                id="square-{{file}}{{rank}}"></td>
        {%endfor%}
        </tr>
    {%endfor%}
    </table>


{%endblock%}
